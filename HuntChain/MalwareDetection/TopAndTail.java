package MalwareDetection;

import java.io.*;
import java.lang.reflect.Array;
import java.nio.ByteBuffer;
import java.util.Arrays;

public class TopAndTail extends SignatureDetection {

    public String fullHash;
    private String fileName;

    public TopAndTail(String filePath, int nbrByte) {
        super(filePath);
        scanFileAndCombine(new File(filePath), nbrByte);
    }


    @Override
    public void scanFileAndCombine(File file, int nbrByte) {
        fileName = file.getName();

        byte[] topByte = readTopByte(file,nbrByte);
        byte[] tailByte = readTailByte(file, nbrByte);

        byte[] allByte = new byte[topByte.length + tailByte.length];
        ByteBuffer buff = ByteBuffer.wrap(allByte);
        buff.put(topByte);
        buff.put(tailByte);

        byte[] combined = buff.array();

        //System.out.println(super.SHAsum(combined,"SHA-256"));
        fullHash = super.SHAsum(combined, "SHA-256");

        //System.out.println(Arrays.toString(combined));
        //System.out.println(new String(combined));


        /*System.out.println(super.SHAsum(topByte,"SHA-256"));
        fullHash = super.SHAsum(topByte,"SHA-256");

        System.out.println(Arrays.toString(topByte));
        System.out.println(new String(topByte));*/
    }



    public byte[] readTopByte(File file, int nbrByte){
        byte[] buf = new byte[nbrByte];

        InputStream ios = null;
        try {
            ios = new FileInputStream(file);
            if (ios.read(buf) == -1){
                System.err.println("Error");
            }
        }catch (IOException e){
            e.printStackTrace();
        } finally {
            try {
                if (ios!=null){
                    ios.close();
                }
            } catch (IOException e){
                e.printStackTrace();
            }
        }

        return buf;
    }


    public byte[] readTailByte(File file, int nbrByte){
        byte[] a = new byte[nbrByte];
        try {
            FileInputStream fis = new FileInputStream(file);
            fis.getChannel().position(fis.getChannel().size() - nbrByte);
            fis.read(a);

            //System.out.println(" BOTTOM " + Arrays.toString(a));
            //System.out.println(new String(a));
        } catch (Exception e){

        }

        return a;
    }


    public String getFileName(){
        return fileName;
    }


}
